# Проект "Трекер привычек"  

## Общее назначение
Сервис создан для хранения и создания полезных и приятных привычек. А также отправки пользователям напоминания
о необходимости выполнять текущие привычки через телеграм-бота.  

<hr>

## Функциональность

### Пользователи
- Реализован эндпоинт для создания пользователя
- Реализованы эндпоинты для авторизация (через simple-jwt)

### Привычки
- Реализован доступ к привычкам по механизму CRUD
  
  В качестве вывода списка привычек реализовано два эндпоинта: для публичных привычек и для привычек пользователя.


- Настроена пагинация

  Для всех страниц по 10 объектов на страницу, для списка привычек пользователя - по 5 объектов.


- Настроен ряд валидаторов для создания и изменения привычек
  - Исключен одновременный выбор связанной привычки и указания вознаграждения.
  - Время выполнения должно быть не больше 120 секунд.
  - В связанные привычки могут попадать только привычки с признаком приятной привычки.
  - У приятной привычки не может быть вознаграждения или связанной привычки.
  - Нельзя выполнять привычку реже, чем 1 раз в 7 дней.



- Настроены права доступа
  - Создание - только авторизованные пользователи
  - Просмотр списка публичных привычек - любой пользователь
  - Просмотр списка своих привычек - авторизованный пользватель
  - Просмотр одной привычки / Изменение / Удаление - только владелец привычки

### ТГ-бот
- Реализован сбор пользователей, которые обратились к боту.
- Реализована рассылка пользователям, которые ранее обращались к боту, в тг информация о привычках, которые нужно повторить.

<hr>

## Запуск проекта

1. Скопируйте проект, установите виртуальное окружение и зависимости из `requirements.txt`/

2. В файле `config/settings.py` при необходимости измените настройки базы данных. 
В проекте используется локальный `postgresql`, база с именем `django_elearning`, 
пользователь `postgres` с входом для локального подключения без пароля
```
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'habit_tracker',
        'USER': 'postgres',
    }
}
```

3. Создайте пустую базу данных с именем `habit_tracker` (при локольном входе в `postgresql` без пароля):
```
psql -U postgres
create database habit_tracker;
\q
```

4. Примените миграции
```
python3 manage.py migrate
```

5. Создайте файл `.env` и запишите в него (пример структуры файла в `.env_sample`)
- TG_BOT_TOKEN=(токен вашего бота)
- TG_URL=https://api.telegram.org/bot


6. При желании загрузите тестовые привычки из фикстуры
```
python3 manage.py loaddata data_habits.json
```

7. Создайте админа и в админке задайте периодические задачи
  - для получения новых сообщений от пользователей
  - отправки сообщений с привычками пользователям
```
python3 manage.py createsuperuser
```

8. Запустите сервер
```
python3 manage.py runserver
```

9. Запустите celery для отложенных и периодических задач
```
celery -A config worker -l INFO
celery -A config beat -l INFO -S django
```

10. При желании можете запустить тесты и узнать покрытие
```
coverage run --source='.' manage.py test
coverage report
```
