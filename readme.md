# Проект "Трекер привычек"  

## Общее назначение
Сервис создан для хранения и создания полезных и приятных привычек. А также отправки пользователям напоминания
о необходимости выполнять текущие привычки через телеграм-бота.  

<hr>

## Запуск проекта

1. Клонируйте исходники проекта:
```
git clone https://github.com/Anna-Kolmychek/habit_tracker.git
```

2. Создайте файл `.env` и запишите в него (пример структуры файла в `.env_sample`)
- TG_BOT_TOKEN=(токен вашего бота)
- TG_URL=https://api.telegram.org/bot

3. Запустите проект с помощью docker-compose
```
docker-compose up --build
```

4. При желании загрузите тестовые привычки из фикстуры
```
docker-compose exec app python3 manage.py loaddata data_habits.json
```

5. Создайте админа и в админке задайте периодические задачи
  - для получения новых сообщений от пользователей
  - отправки сообщений с привычками пользователям
```
# создать админа
docker-compose exec app python3 manage.py createsuperuser

# админка по адресу
http://localhost:8000/admin/

В админке переходим в Periodic Tasks ->
1) Add -> Заполняем поля для получению юзеров, напирмер так
Name: Get Users
Task (registered): tg_bot.tasks.get_tg_bot_update
Interval Schedule: every 5 seconds
Start Datetime:
  Date - Today | 
  Time:  Now | 

2) Add -> Заполняем поля для отправки привычек, напирмер так
Name: Check habits
Task (registered): tg_bot.tasks.check_habits
Interval Schedule: every 5 seconds
Start Datetime:
  Date - Today | 
  Time:  Now | 
```

6. При желании можете запустить тесты и узнать покрытие
```
docker-compose exec app coverage run --source='.' manage.py test
docker-compose exec app coverage report
```

<hr>

## Функциональность

### Пользователи
- Реализован эндпоинт для создания пользователя
- Реализованы эндпоинты для авторизация (через simple-jwt)

### Привычки
- Реализован доступ к привычкам по механизму CRUD
  
  В качестве вывода списка привычек реализовано два эндпоинта: для публичных привычек и для привычек пользователя.


- Настроена пагинация

  Для всех страниц по 10 объектов на страницу, для списка привычек пользователя - по 5 объектов.


- Настроен ряд валидаторов для создания и изменения привычек
  - Исключен одновременный выбор связанной привычки и указания вознаграждения.
  - Время выполнения должно быть не больше 120 секунд.
  - В связанные привычки могут попадать только привычки с признаком приятной привычки.
  - У приятной привычки не может быть вознаграждения или связанной привычки.
  - Нельзя выполнять привычку реже, чем 1 раз в 7 дней.



- Настроены права доступа
  - Создание - только авторизованные пользователи
  - Просмотр списка публичных привычек - любой пользователь
  - Просмотр списка своих привычек - авторизованный пользватель
  - Просмотр одной привычки / Изменение / Удаление - только владелец привычки

### ТГ-бот
- Реализован сбор пользователей, которые обратились к боту.
- Реализована рассылка пользователям, которые ранее обращались к боту, в тг информация о привычках, которые нужно повторить.

### Docker

- Описан Dockerfile для django-приложения
- Создан docker-compose для всех сервисов, необходимых для запуска приложения
(django-приложение, postgresql, redis, celery)

